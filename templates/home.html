<!DOCTYPE html>
{% from 'bootstrap5/form.html' import render_form %}
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    {{ bootstrap.load_css() }}
    <meta charset="UTF-8">
    <title>All Products</title>
</head>
<body>
{{ bootstrap.load_js() }}
<div class="container-fluid px-5 py-5">
<h1>All Products</h1>


<br>


 <h3>Scrape Jobs</h3>
<table class="table table-bordered">
    <tr>
        <th>Snapshot ID</th>
        <th>Keyword</th>
        <th>Status</th>
        <th>Date of scrape</th>
    </tr>
    {% for job in jobs %}
    <tr>
        <td>{{ job.snapshot_id }}</td>
        <td>{{ job.keyword }}</td>
        <td>{{ job.status }}</td>
        <td>{{ job.created_at.strftime("%m/%d/%Y, %H:%M:%S")}} GMT</td>
        <td>
            <a href="{{ url_for('import_snapshot', snapshot_id=job.snapshot_id) }}" class="btn btn-dark">
                Import Results
            </a>

        </td>
    </tr>
    {% endfor %}

</table>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}" role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}
{{ render_form(form) }}

<br><a href="{{ url_for('favourites') }}" class="btn btn-dark">
  Favourites <i class="bi bi-arrow-right"></i>
</a><br><br>


<h3>{{total_entries}} total entries</h3>
<table class="table table-dark table-striped">
    <tr>
        <th>Add to favourites</th>
        <th>Name</th>
        <th>Image URL</th>
        <th>Website URL</th>
        <th>Item Price</th>
        <th>Date of last scrape GMT</th>
        <th>Delete Entry</th>
    </tr>

    {% for data in db_data %}
    <tr>

        <td>
            <form action="{{ url_for('mark_favourites',product_id=data.id) }}" method="post">
                <input class="btn btn-dark" type="submit" value="Favourite">
            </form>
        </td>

        <td>
            <a href= "{{ url_for('view_product', product_id = data.id) }}">{{ data.name }}</a>
        </td>
    <td>{{data.img_url}}</td>
    <td>{{data.url}}</td>
    <td>${{data.price}}</td>
    <td>{{data.created_at.strftime("%m/%d/%Y, %H:%M:%S")}}</td>
        <td>
            <form action="{{ url_for('delete_product',product_id=data.id) }}" method="post">
                <input class="btn btn-danger" type="submit" value="Delete"
                onclick="return confirm('Are you sure you want to delete {{ data.name }}?');">
            </form>

        </td>



    </tr>
    {%endfor%}
</table>
</div>
</body>

</html>